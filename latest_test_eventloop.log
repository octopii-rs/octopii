warning: method `file` is never used
  --> src/wal/wal/storage.rs:55:19
   |
18 | impl FdBackend {
   | -------------- method in this implementation
...
55 |     pub(crate) fn file(&self) -> &std::fs::File {
   |                   ^^^^
   |
   = note: `#[warn(dead_code)]` on by default

warning: method `as_fd` is never used
   --> src/wal/wal/storage.rs:106:19
    |
66  | impl StorageImpl {
    | ---------------- method in this implementation
...
106 |     pub(crate) fn as_fd(&self) -> Option<&FdBackend> {
    |                   ^^^^^

warning: methods `len` and `storage` are never used
   --> src/wal/wal/storage.rs:184:19
    |
151 | impl SharedMmap {
    | --------------- methods in this implementation
...
184 |     pub(crate) fn len(&self) -> usize {
    |                   ^^^
...
192 |     pub(crate) fn storage(&self) -> &StorageImpl {
    |                   ^^^^^^^

warning: function `fsync_schedule` is never used
   --> src/wal/wal/storage.rs:252:15
    |
252 | pub(crate) fn fsync_schedule() -> Option<FsyncSchedule> {
    |               ^^^^^^^^^^^^^^

warning: `octopii` (lib) generated 4 warnings
warning: struct `TestNode` is never constructed
 --> tests/raft_comprehensive/common.rs:8:12
  |
8 | pub struct TestNode {
  |            ^^^^^^^^
  |
  = note: `#[warn(dead_code)]` on by default

warning: multiple associated items are never used
   --> tests/raft_comprehensive/common.rs:18:18
    |
16  | impl TestNode {
    | ------------- associated items in this implementation
17  |     /// Create a new test node with unique isolated WAL (async version)
18  |     pub async fn new(
    |                  ^^^
...
58  |     pub async fn start(&self) -> Result<(), Box<dyn std::error::Error>> {
    |                  ^^^^^
...
66  |     pub fn crash(&mut self) {
    |            ^^^^^
...
74  |     pub async fn restart(&mut self) -> Result<(), Box<dyn std::error::Error>> {
    |                  ^^^^^^^
...
90  |     pub fn get_node(&self) -> Option<&OctopiiNode> {
    |            ^^^^^^^^
...
95  |     pub async fn campaign(&self) -> Result<(), String> {
    |                  ^^^^^^^^
...
104 |     pub async fn is_leader(&self) -> bool {
    |                  ^^^^^^^^^
...
113 |     pub async fn propose(&self, data: Vec<u8>) -> Result<bytes::Bytes, String> {
    |                  ^^^^^^^
...
122 |     pub async fn query(&self, command: &[u8]) -> Result<bytes::Bytes, String> {
    |                  ^^^^^

warning: struct `TestCluster` is never constructed
   --> tests/raft_comprehensive/common.rs:132:12
    |
132 | pub struct TestCluster {
    |            ^^^^^^^^^^^

warning: multiple associated items are never used
   --> tests/raft_comprehensive/common.rs:139:18
    |
137 | impl TestCluster {
    | ---------------- associated items in this implementation
138 |     /// Create a new cluster with N nodes (async version)
139 |     pub async fn new(node_ids: Vec<u64>, base_port: u16) -> Self {
    |                  ^^^
...
172 |     pub async fn start_all(&self) -> Result<(), Box<dyn std::error::Error>> {
    |                  ^^^^^^^^^
...
180 |     pub fn get_node(&self, idx: usize) -> Option<&TestNode> {
    |            ^^^^^^^^
...
185 |     pub fn get_node_mut(&mut self, idx: usize) -> Option<&mut TestNode> {
    |            ^^^^^^^^^^^^
...
190 |     pub fn crash_node(&mut self, node_id: u64) -> Result<(), Box<dyn std::error::Error>> {
    |            ^^^^^^^^^^
...
200 |     pub async fn restart_node(&mut self, node_id: u64) -> Result<(), Box<dyn std::error::Error>> {
    |                  ^^^^^^^^^^^^
...
211 |     pub async fn verify_convergence(&self, max_wait: Duration) -> Result<(), String> {
    |                  ^^^^^^^^^^^^^^^^^^
...
238 |     pub async fn verify_state_machine_consistency(&self) -> Result<(), String> {
    |                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
...
262 |     pub async fn add_learner(&mut self, node_id: u64) -> Result<(), Box<dyn std::error::Error>> {
    |                  ^^^^^^^^^^^
...
298 |     pub async fn promote_learner(
    |                  ^^^^^^^^^^^^^^^
...
327 |     pub async fn is_learner_caught_up(
    |                  ^^^^^^^^^^^^^^^^^^^^
...
356 |     pub async fn wait_for_leader_election(&self, timeout: Duration) -> Result<u64, String> {
    |                  ^^^^^^^^^^^^^^^^^^^^^^^^
...
372 |     pub async fn has_leader(&self) -> bool {
    |                  ^^^^^^^^^^
...
384 |     pub fn get_wal_disk_usage(&self, node_id: u64) -> Result<u64, Box<dyn std::error::Error>> {
    |            ^^^^^^^^^^^^^^^^^^
...
407 |     pub async fn count_committed_entries(&self) -> usize {
    |                  ^^^^^^^^^^^^^^^^^^^^^^^
...
420 |     pub fn shutdown_all(&mut self) {
    |            ^^^^^^^^^^^^

warning: function `wait_for` is never used
   --> tests/raft_comprehensive/common.rs:428:14
    |
428 | pub async fn wait_for<F>(
    |              ^^^^^^^^

warning: field `addr` is never read
  --> tests/raft_comprehensive/common.rs:12:9
   |
8  | pub struct TestNode {
   |            -------- field in this struct
...
12 |     pub addr: SocketAddr,
   |         ^^^^

warning: method `get_node` is never used
  --> tests/raft_comprehensive/common.rs:90:12
   |
16 | impl TestNode {
   | ------------- method in this implementation
...
90 |     pub fn get_node(&self) -> Option<&OctopiiNode> {
   |            ^^^^^^^^

warning: field `base_port` is never read
   --> tests/raft_comprehensive/common.rs:134:9
    |
132 | pub struct TestCluster {
    |            ----------- field in this struct
133 |     pub nodes: Vec<TestNode>,
134 |     pub base_port: u16,
    |         ^^^^^^^^^

warning: multiple methods are never used
   --> tests/raft_comprehensive/common.rs:180:12
    |
137 | impl TestCluster {
    | ---------------- methods in this implementation
...
180 |     pub fn get_node(&self, idx: usize) -> Option<&TestNode> {
    |            ^^^^^^^^
...
185 |     pub fn get_node_mut(&mut self, idx: usize) -> Option<&mut TestNode> {
    |            ^^^^^^^^^^^^
...
238 |     pub async fn verify_state_machine_consistency(&self) -> Result<(), String> {
    |                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
...
262 |     pub async fn add_learner(&mut self, node_id: u64) -> Result<(), Box<dyn std::error::Error>> {
    |                  ^^^^^^^^^^^
...
298 |     pub async fn promote_learner(
    |                  ^^^^^^^^^^^^^^^
...
327 |     pub async fn is_learner_caught_up(
    |                  ^^^^^^^^^^^^^^^^^^^^
...
356 |     pub async fn wait_for_leader_election(&self, timeout: Duration) -> Result<u64, String> {
    |                  ^^^^^^^^^^^^^^^^^^^^^^^^
...
372 |     pub async fn has_leader(&self) -> bool {
    |                  ^^^^^^^^^^
...
384 |     pub fn get_wal_disk_usage(&self, node_id: u64) -> Result<u64, Box<dyn std::error::Error>> {
    |            ^^^^^^^^^^^^^^^^^^
...
407 |     pub async fn count_committed_entries(&self) -> usize {
    |                  ^^^^^^^^^^^^^^^^^^^^^^^

warning: methods `get_node` and `query` are never used
   --> tests/raft_comprehensive/common.rs:90:12
    |
16  | impl TestNode {
    | ------------- methods in this implementation
...
90  |     pub fn get_node(&self) -> Option<&OctopiiNode> {
    |            ^^^^^^^^
...
122 |     pub async fn query(&self, command: &[u8]) -> Result<bytes::Bytes, String> {
    |                  ^^^^^

warning: fields `config` and `node_id` are never read
  --> tests/raft_comprehensive/common.rs:10:9
   |
8  | pub struct TestNode {
   |            -------- fields in this struct
9  |     pub node: Option<OctopiiNode>,
10 |     pub config: Config,
   |         ^^^^^^
11 |     pub node_id: u64,
   |         ^^^^^^^

warning: methods `restart` and `query` are never used
   --> tests/raft_comprehensive/common.rs:74:18
    |
16  | impl TestNode {
    | ------------- methods in this implementation
...
74  |     pub async fn restart(&mut self) -> Result<(), Box<dyn std::error::Error>> {
    |                  ^^^^^^^
...
122 |     pub async fn query(&self, command: &[u8]) -> Result<bytes::Bytes, String> {
    |                  ^^^^^

warning: multiple methods are never used
   --> tests/raft_comprehensive/common.rs:180:12
    |
137 | impl TestCluster {
    | ---------------- methods in this implementation
...
180 |     pub fn get_node(&self, idx: usize) -> Option<&TestNode> {
    |            ^^^^^^^^
...
185 |     pub fn get_node_mut(&mut self, idx: usize) -> Option<&mut TestNode> {
    |            ^^^^^^^^^^^^
...
190 |     pub fn crash_node(&mut self, node_id: u64) -> Result<(), Box<dyn std::error::Error>> {
    |            ^^^^^^^^^^
...
200 |     pub async fn restart_node(&mut self, node_id: u64) -> Result<(), Box<dyn std::error::Error>> {
    |                  ^^^^^^^^^^^^
...
211 |     pub async fn verify_convergence(&self, max_wait: Duration) -> Result<(), String> {
    |                  ^^^^^^^^^^^^^^^^^^
...
238 |     pub async fn verify_state_machine_consistency(&self) -> Result<(), String> {
    |                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
...
356 |     pub async fn wait_for_leader_election(&self, timeout: Duration) -> Result<u64, String> {
    |                  ^^^^^^^^^^^^^^^^^^^^^^^^
...
372 |     pub async fn has_leader(&self) -> bool {
    |                  ^^^^^^^^^^
...
384 |     pub fn get_wal_disk_usage(&self, node_id: u64) -> Result<u64, Box<dyn std::error::Error>> {
    |            ^^^^^^^^^^^^^^^^^^
...
407 |     pub async fn count_committed_entries(&self) -> usize {
    |                  ^^^^^^^^^^^^^^^^^^^^^^^

warning: fields `config` and `addr` are never read
  --> tests/raft_comprehensive/common.rs:10:9
   |
8  | pub struct TestNode {
   |            -------- fields in this struct
9  |     pub node: Option<OctopiiNode>,
10 |     pub config: Config,
   |         ^^^^^^
11 |     pub node_id: u64,
12 |     pub addr: SocketAddr,
   |         ^^^^

warning: multiple methods are never used
   --> tests/raft_comprehensive/common.rs:180:12
    |
137 | impl TestCluster {
    | ---------------- methods in this implementation
...
180 |     pub fn get_node(&self, idx: usize) -> Option<&TestNode> {
    |            ^^^^^^^^
...
185 |     pub fn get_node_mut(&mut self, idx: usize) -> Option<&mut TestNode> {
    |            ^^^^^^^^^^^^
...
200 |     pub async fn restart_node(&mut self, node_id: u64) -> Result<(), Box<dyn std::error::Error>> {
    |                  ^^^^^^^^^^^^
...
211 |     pub async fn verify_convergence(&self, max_wait: Duration) -> Result<(), String> {
    |                  ^^^^^^^^^^^^^^^^^^
...
238 |     pub async fn verify_state_machine_consistency(&self) -> Result<(), String> {
    |                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
...
262 |     pub async fn add_learner(&mut self, node_id: u64) -> Result<(), Box<dyn std::error::Error>> {
    |                  ^^^^^^^^^^^
...
298 |     pub async fn promote_learner(
    |                  ^^^^^^^^^^^^^^^
...
327 |     pub async fn is_learner_caught_up(
    |                  ^^^^^^^^^^^^^^^^^^^^
...
384 |     pub fn get_wal_disk_usage(&self, node_id: u64) -> Result<u64, Box<dyn std::error::Error>> {
    |            ^^^^^^^^^^^^^^^^^^
...
407 |     pub async fn count_committed_entries(&self) -> usize {
    |                  ^^^^^^^^^^^^^^^^^^^^^^^

warning: methods `is_leader` and `query` are never used
   --> tests/raft_comprehensive/common.rs:104:18
    |
16  | impl TestNode {
    | ------------- methods in this implementation
...
104 |     pub async fn is_leader(&self) -> bool {
    |                  ^^^^^^^^^
...
122 |     pub async fn query(&self, command: &[u8]) -> Result<bytes::Bytes, String> {
    |                  ^^^^^

warning: multiple methods are never used
   --> tests/raft_comprehensive/common.rs:180:12
    |
137 | impl TestCluster {
    | ---------------- methods in this implementation
...
180 |     pub fn get_node(&self, idx: usize) -> Option<&TestNode> {
    |            ^^^^^^^^
...
185 |     pub fn get_node_mut(&mut self, idx: usize) -> Option<&mut TestNode> {
    |            ^^^^^^^^^^^^
...
190 |     pub fn crash_node(&mut self, node_id: u64) -> Result<(), Box<dyn std::error::Error>> {
    |            ^^^^^^^^^^
...
211 |     pub async fn verify_convergence(&self, max_wait: Duration) -> Result<(), String> {
    |                  ^^^^^^^^^^^^^^^^^^
...
238 |     pub async fn verify_state_machine_consistency(&self) -> Result<(), String> {
    |                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
...
298 |     pub async fn promote_learner(
    |                  ^^^^^^^^^^^^^^^
...
356 |     pub async fn wait_for_leader_election(&self, timeout: Duration) -> Result<u64, String> {
    |                  ^^^^^^^^^^^^^^^^^^^^^^^^
...
372 |     pub async fn has_leader(&self) -> bool {
    |                  ^^^^^^^^^^
...
407 |     pub async fn count_committed_entries(&self) -> usize {
    |                  ^^^^^^^^^^^^^^^^^^^^^^^

warning: method `query` is never used
   --> tests/raft_comprehensive/common.rs:122:18
    |
16  | impl TestNode {
    | ------------- method in this implementation
...
122 |     pub async fn query(&self, command: &[u8]) -> Result<bytes::Bytes, String> {
    |                  ^^^^^

warning: multiple methods are never used
   --> tests/raft_comprehensive/common.rs:180:12
    |
137 | impl TestCluster {
    | ---------------- methods in this implementation
...
180 |     pub fn get_node(&self, idx: usize) -> Option<&TestNode> {
    |            ^^^^^^^^
...
185 |     pub fn get_node_mut(&mut self, idx: usize) -> Option<&mut TestNode> {
    |            ^^^^^^^^^^^^
...
211 |     pub async fn verify_convergence(&self, max_wait: Duration) -> Result<(), String> {
    |                  ^^^^^^^^^^^^^^^^^^
...
238 |     pub async fn verify_state_machine_consistency(&self) -> Result<(), String> {
    |                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
...
262 |     pub async fn add_learner(&mut self, node_id: u64) -> Result<(), Box<dyn std::error::Error>> {
    |                  ^^^^^^^^^^^
...
298 |     pub async fn promote_learner(
    |                  ^^^^^^^^^^^^^^^
...
327 |     pub async fn is_learner_caught_up(
    |                  ^^^^^^^^^^^^^^^^^^^^
...
356 |     pub async fn wait_for_leader_election(&self, timeout: Duration) -> Result<u64, String> {
    |                  ^^^^^^^^^^^^^^^^^^^^^^^^
...
384 |     pub fn get_wal_disk_usage(&self, node_id: u64) -> Result<u64, Box<dyn std::error::Error>> {
    |            ^^^^^^^^^^^^^^^^^^
...
407 |     pub async fn count_committed_entries(&self) -> usize {
    |                  ^^^^^^^^^^^^^^^^^^^^^^^

warning: multiple methods are never used
   --> tests/raft_comprehensive/common.rs:180:12
    |
137 | impl TestCluster {
    | ---------------- methods in this implementation
...
180 |     pub fn get_node(&self, idx: usize) -> Option<&TestNode> {
    |            ^^^^^^^^
...
185 |     pub fn get_node_mut(&mut self, idx: usize) -> Option<&mut TestNode> {
    |            ^^^^^^^^^^^^
...
190 |     pub fn crash_node(&mut self, node_id: u64) -> Result<(), Box<dyn std::error::Error>> {
    |            ^^^^^^^^^^
...
238 |     pub async fn verify_state_machine_consistency(&self) -> Result<(), String> {
    |                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
...
262 |     pub async fn add_learner(&mut self, node_id: u64) -> Result<(), Box<dyn std::error::Error>> {
    |                  ^^^^^^^^^^^
...
298 |     pub async fn promote_learner(
    |                  ^^^^^^^^^^^^^^^
...
327 |     pub async fn is_learner_caught_up(
    |                  ^^^^^^^^^^^^^^^^^^^^
...
356 |     pub async fn wait_for_leader_election(&self, timeout: Duration) -> Result<u64, String> {
    |                  ^^^^^^^^^^^^^^^^^^^^^^^^
...
372 |     pub async fn has_leader(&self) -> bool {
    |                  ^^^^^^^^^^
...
384 |     pub fn get_wal_disk_usage(&self, node_id: u64) -> Result<u64, Box<dyn std::error::Error>> {
    |            ^^^^^^^^^^^^^^^^^^
...
407 |     pub async fn count_committed_entries(&self) -> usize {
    |                  ^^^^^^^^^^^^^^^^^^^^^^^

warning: methods `get_node`, `get_node_mut`, `verify_convergence`, `verify_state_machine_consistency`, `wait_for_leader_election`, and `count_committed_entries` are never used
   --> tests/raft_comprehensive/common.rs:180:12
    |
137 | impl TestCluster {
    | ---------------- methods in this implementation
...
180 |     pub fn get_node(&self, idx: usize) -> Option<&TestNode> {
    |            ^^^^^^^^
...
185 |     pub fn get_node_mut(&mut self, idx: usize) -> Option<&mut TestNode> {
    |            ^^^^^^^^^^^^
...
211 |     pub async fn verify_convergence(&self, max_wait: Duration) -> Result<(), String> {
    |                  ^^^^^^^^^^^^^^^^^^
...
238 |     pub async fn verify_state_machine_consistency(&self) -> Result<(), String> {
    |                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
...
356 |     pub async fn wait_for_leader_election(&self, timeout: Duration) -> Result<u64, String> {
    |                  ^^^^^^^^^^^^^^^^^^^^^^^^
...
407 |     pub async fn count_committed_entries(&self) -> usize {
    |                  ^^^^^^^^^^^^^^^^^^^^^^^

warning: `octopii` (test "raft_comprehensive_test") generated 50 warnings (29 duplicates)
    Finished `test` profile [unoptimized + debuginfo] target(s) in 0.09s
     Running tests/raft_comprehensive_test.rs (target/debug/deps/raft_comprehensive_test-aa7927a5bbdb3a0b)

running 1 test
[2m2025-11-08T23:06:16.071926Z[0m [32m INFO[0m [2mraft_comprehensive_test::automatic_election_tests[0m[2m:[0m === Starting automatic election after leader failure test ===

thread 'automatic_election_tests::test_automatic_election_after_leader_failure' panicked at tests/raft_comprehensive/common.rs:46:68:
called `Result::unwrap()` on an `Err` value: Io(Os { code: 1, kind: PermissionDenied, message: "Operation not permitted" })
note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace
test automatic_election_tests::test_automatic_election_after_leader_failure ... FAILED

failures:

failures:
    automatic_election_tests::test_automatic_election_after_leader_failure

test result: FAILED. 0 passed; 1 failed; 0 ignored; 0 measured; 32 filtered out; finished in 0.00s

error: test failed, to rerun pass `--test raft_comprehensive_test`
